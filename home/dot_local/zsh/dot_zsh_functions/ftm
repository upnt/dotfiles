#!/usr/bin/env zsh
emulate -L zsh
set -euo pipefail

DEFAULT_SESSION_NAME=workspace

tmux start-server

# 既存セッション名を取得
sessions=("alpha" "beta" "gamma")

# fzf候補作成（新規作成も追加）
candidates=("${sessions[@]}")

set +e
selection=$(printf "%s\n" "${candidates[@]}" | \
  fzf --prompt='tmux session> ' --header=$'Enterで選択\n')
fzf_status=$?
set -e

if (( fzf_status != 0 )) || [[ -z "${selection:-}" ]]; then
  if [[ ! -o interactive ]]; then
    exec "${SHELL:-/bin/zsh}" -l
  fi
  return 0 2>/dev/null
  exit 0
fi

in_tmux=${+TMUX}

if ! tmux has-session -t "$selection" 2>/dev/null; then
  autoload -Uz _new_window
  _new_window "$selection"
else
  if (( in_tmux )); then
    tmux switch-client -t "$selection"
  else
    tmux attach -t "$selection"
  fi
fi
