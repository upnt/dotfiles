#!/usr/bin/bash

if [ -z "$GHUX_ALIASES_PATH" ]; then
        echo 'Please set the "GHUX_ALIASES_PATH"'
        exit 1
fi

if [ ! -f "$GHUX_ALIASES_PATH" ]; then
        /usr/bin/touch "$GHUX_ALIASES_PATH"
fi

project_list=()
while read -r line; do
        project_list+=($(eval echo "$line"))
done < <(awk -F, '{print $3}' "$GHUX_ALIASES_PATH")
while read -r line; do
        project_list+=("$(ghq root)/$line")
done < <(ghq list)

candidates=()

for repo in "${project_list[@]}"; do
        if [ ! -d "$repo"/.git ]; then
                continue
        fi
        cd "$repo" || continue
        status=""
        if [ -n "$(git status -s)" ]; then
                status+="M"
        else
                status+="-"
        fi
        candidate+=("$status: $repo,$repo")
done
echo "${candidate[@]}"
